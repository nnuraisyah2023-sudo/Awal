<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>EcoPay ‚Äî Tukar Botol Jadi Uang</title>

  <style>
    :root{
      --bg1:#071025;
      --bg2:#0b2540;
      --glass: rgba(255,255,255,0.06);
      --accent-a: #06b6d4;
      --accent-b: #7c3aed;
      --success: #22c55e;
      --danger: #ef4444;
      --muted: rgba(255,255,255,0.75);
      --card-radius: 16px;
    }
    body{
      margin:0;
      font-family:sans-serif;
      color:#e6eef8;
      background:linear-gradient(120deg,var(--bg1),var(--bg2));
      background-size:400% 400%;
      animation:bgShift 18s ease infinite;
      padding-bottom:90px;
    }
    @keyframes bgShift{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}

    header{padding:20px;display:flex;justify-content:space-between;align-items:center;}
    .brand{display:flex;gap:10px;align-items:center;}
    .logo{width:48px;height:48px;border-radius:12px;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,var(--accent-b),var(--accent-a));font-weight:800;}
    .title h1{margin:0;font-size:18px;font-weight:800}
    .title p{margin:0;font-size:12px;color:rgba(230,238,248,0.7)}

    .container{max-width:1000px;margin:0 auto;padding:0 18px;}
    .grid{display:grid;grid-template-columns:1fr 380px;gap:20px;}
    @media(max-width:920px){.grid{grid-template-columns:1fr}}

    .card{background:var(--glass);border-radius:var(--card-radius);padding:18px;backdrop-filter:blur(10px) saturate(120%);}
    .balance-card{display:flex;justify-content:space-between;align-items:center;}
    .balance-value{font-size:28px;font-weight:800}
    .balance-bar{width:100%;height:10px;background:rgba(255,255,255,0.1);border-radius:8px;margin-top:8px;overflow:hidden;}
    .balance-fill{height:100%;width:0%;background:linear-gradient(90deg,var(--accent-a),var(--accent-b));transition:width 1s ease;}
    .btn{background:linear-gradient(90deg,var(--accent-a),var(--accent-b));border:none;color:white;padding:10px 14px;border-radius:15px;font-weight:700;cursor:pointer;}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.2);color:var(--muted);}
    .form-row{display:flex;gap:12px;margin-top:12px;}
    .form-row input{flex:1;padding:10px;border-radius:10px;border:none;background:rgba(255,255,255,0.1);color:white;}
    .box{margin-top:16px;padding:12px;background:rgba(255,255,255,0.05);border-radius:12px;}
    .history-list{margin-top:12px;display:flex;flex-direction:column;gap:8px;max-height:260px;overflow:auto;}
    .txn{display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:10px;background:rgba(255,255,255,0.05);}
    .txn.credit .amount{color:var(--success);}
    .txn.debit .amount{color:var(--danger);}
    .avatar-large{width:120px;height:120px;border-radius:18px;display:flex;align-items:center;justify-content:center;font-size:36px;font-weight:800;color:white;background:linear-gradient(135deg,var(--accent-b),var(--accent-a));margin:auto;}

    .bottom-nav{position:fixed;left:50%;transform:translateX(-50%);bottom:18px;width:min(820px,96%);display:flex;justify-content:space-between;background:rgba(13,20,38,0.9);padding:10px;border-radius:14px;}
    .nav-item{flex:1;text-align:center;padding:8px;color:rgba(255,255,255,0.8);cursor:pointer;}
    .nav-item.active{background:linear-gradient(90deg,var(--accent-a),var(--accent-b));color:#021225;font-weight:800;}
    .small{font-size:12px;color:rgba(230,238,248,0.7)}

    /* Toast Notification */
    .toast-container{position:fixed;top:20px;right:20px;display:flex;flex-direction:column;gap:10px;z-index:9999;}
    .toast{padding:12px 18px;border-radius:10px;color:white;font-weight:600;animation:fadeIn 0.5s, fadeOut 0.5s 2.5s forwards;}
    .toast.success{background:linear-gradient(90deg,#22c55e,#16a34a);}
    .toast.error{background:linear-gradient(90deg,#ef4444,#dc2626);}
    @keyframes fadeIn{from{opacity:0;transform:translateY(-20px);}to{opacity:1;transform:translateY(0);}}
    @keyframes fadeOut{to{opacity:0;transform:translateY(-20px);}}

    /* === LOADING SCREEN === */
    #loadingScreen{
      position:fixed;top:0;left:0;width:100%;height:100%;
      background:linear-gradient(135deg,#0f1724,#201535);
      display:flex;flex-direction:column;justify-content:center;align-items:center;
      z-index:99999;color:#fff;transition:opacity 1s ease,visibility 1s;
    }
    #loadingScreen.hide{opacity:0;visibility:hidden;}
    .loading-title{
      font-size:32px;font-weight:800;margin-bottom:20px;
      background:linear-gradient(90deg,#d4af37,#fff);
      -webkit-background-clip:text;-webkit-text-fill-color:transparent;
      animation:glow 2s infinite alternate;
    }
    @keyframes glow{
      from{text-shadow:0 0 8px rgba(212,175,55,0.3);}
      to{text-shadow:0 0 20px rgba(212,175,55,0.8);}
    }
    .ring{
      width:80px;height:80px;border-radius:50%;
      border:6px solid rgba(255,255,255,0.1);
      border-top-color:#d4af37;
      animation:spin 1.5s linear infinite;
    }
    @keyframes spin{to{transform:rotate(360deg)}}
  </style>
</head>
<body>
  <!-- Loading Screen -->
  <div id="loadingScreen">
    <div class="loading-title">HIDUP SEHAT LINGKUNGAN SEHAT</div>
    <div class="ring"></div>
  </div>

  <header>
    <div class="brand">
      <div class="logo">iP</div>
      <div class="title">
        <h1>iWALLPay</h1>
        <p>Penukaran Botol Jadi Uang</p>
      </div>
    </div>
    <div class="small">Selamat datang!</div>
  </header>

  <main class="container">
    <div class="grid">
      <!-- Kiri -->
      <div>
        <div id="home" class="card">
          <div class="balance-card">
            <div style="flex:1">
              <div class="small">Saldo</div>
              <div class="balance-value" id="balanceValue">Rp 0</div>
              <div class="balance-bar"><div id="balanceFill" class="balance-fill"></div></div>
              <div class="small" id="userNameDisplay">Pengguna</div>
            </div>
          </div>
        </div>

        <div id="tukar" class="card" style="margin-top:18px;">
          <h3>Tukar Botol</h3>
          <div class="form-row">
            <input id="inputBotol" type="number" min="1" placeholder="Jumlah botol">
            <button class="btn" id="btnTukar">Tukar</button>
          </div>
          <div class="box">
            <div class="small">Tarik Saldo (min Rp 1.000)</div>
            <div class="form-row">
              <input id="inputTarik" type="number" min="1000" placeholder="Nominal (Rp)">
              <button class="btn ghost" id="btnTarik">Tarik</button>
            </div>
          </div>
        </div>

        <div id="riwayat" class="card" style="margin-top:18px;">
          <h3>Riwayat</h3>
          <div id="historyList" class="history-list"></div>
        </div>
      </div>

      <!-- Kanan -->
      <div>
        <div id="profil" class="card">
          <div>
            <label for="avatarInput" style="cursor:pointer">
              <div id="avatarLarge" class="avatar-large">‚ôª</div>
            </label>
            <input id="avatarInput" type="file" accept="image/*" style="display:none">
          </div>
          <div class="form-row"><input id="profileName" type="text" placeholder="Nama"></div>
          <div class="form-row"><input id="profileHP" type="text" placeholder="No. HP"></div>
          <button class="btn" id="btnSaveProfile" style="width:100%">Simpan Profil</button>
        </div>
      </div>
    </div>
  </main>

  <!-- Bottom Nav -->
  <div class="bottom-nav">
    <div class="nav-item active" data-target="home">üè† Home</div>
    <div class="nav-item" data-target="tukar">‚ôª Tukar</div>
    <div class="nav-item" data-target="riwayat">üìú Riwayat</div>
    <div class="nav-item" data-target="profil">üë§ Profil</div>
  </div>

  <!-- Toast Container -->
  <div class="toast-container" id="toastContainer"></div>

  <script>
    const KEY_BAL='ecopay_balance',KEY_TX='ecopay_tx',KEY_PROFILE='ecopay_profile';
    let balance=parseInt(localStorage.getItem(KEY_BAL))||0;
    let txns=JSON.parse(localStorage.getItem(KEY_TX))||[];
    let profile=JSON.parse(localStorage.getItem(KEY_PROFILE))||{name:'Pengguna',hp:'',avatar:''};
    const RATE=500;

    function formatRupiah(n){return 'Rp '+(n||0).toString().replace(/\B(?=(\d{3})+(?!\d))/g,'.')}
    function save(){localStorage.setItem(KEY_BAL,balance);localStorage.setItem(KEY_TX,JSON.stringify(txns));localStorage.setItem(KEY_PROFILE,JSON.stringify(profile));}

    // Toast
    function showToast(msg,type='success'){
      const c=document.getElementById('toastContainer');
      const t=document.createElement('div');
      t.className='toast '+type;
      t.textContent=msg;
      c.appendChild(t);
      setTimeout(()=>t.remove(),3000);
    }
    function flashSuccess(m){showToast(m,'success')}
    function flashError(m){showToast(m,'error')}

    // Render
    function render(){
      document.getElementById('balanceValue').innerText=formatRupiah(balance);
      document.getElementById('userNameDisplay').innerText=profile.name||'Pengguna';
      document.getElementById('profileName').value=profile.name||'';
      document.getElementById('profileHP').value=profile.hp||'';
      document.getElementById('avatarLarge').innerHTML=profile.avatar?`<img src="${profile.avatar}" style="width:100%;height:100%;border-radius:18px;object-fit:cover">`:'‚ôª';
      const max=100000; 
      const fill=Math.min((balance/max)*100,100);
      document.getElementById('balanceFill').style.width=fill+'%';
      const h=document.getElementById('historyList');h.innerHTML='';
      if(txns.length===0){h.innerHTML='<div class="small">Belum ada transaksi</div>';return;}
      txns.forEach(t=>{
        const div=document.createElement('div');div.className='txn '+t.type;
        div.innerHTML=`<div><div>${t.desc}</div><div class="small">${new Date(t.ts).toLocaleString('id-ID')}</div></div><div class="amount">${t.type==='credit'?'+ ':'- '}${formatRupiah(t.amount)}</div>`;
        h.appendChild(div);
      });
    }

    function pushTxn(type,desc,amt){txns.unshift({id:Date.now(),type,desc,amount:amt,ts:new Date().toISOString()});save();render();}

    // Events
    document.getElementById('btnTukar').onclick=()=>{
      const v=+document.getElementById('inputBotol').value;if(v<1)return flashError('Masukkan jumlah botol valid');
      const amt=v*RATE;balance+=amt;pushTxn('credit',`Tukar ${v} botol`,amt);flashSuccess(`+ ${formatRupiah(amt)}`);document.getElementById('inputBotol').value='';
    }
    document.getElementById('btnTarik').onclick=()=>{
      const v=+document.getElementById('inputTarik').value;if(v<1000)return flashError('Minimal Rp 1.000');
      if(v>balance)return flashError('Saldo tidak cukup');balance-=v;pushTxn('debit','Penarikan',v);flashSuccess(`- ${formatRupiah(v)}`);document.getElementById('inputTarik').value='';
    }
    document.getElementById('btnSaveProfile').onclick=()=>{
      profile.name=document.getElementById('profileName').value.trim();
      profile.hp=document.getElementById('profileHP').value.trim();
      save();render();flashSuccess('Profil disimpan');
    }
    document.getElementById('avatarInput').onchange=e=>{
      const f=e.target.files[0];if(!f)return;if(f.size>2*1024*1024)return flashError('Maks 2MB');
      const r=new FileReader();r.onload=ev=>{profile.avatar=ev.target.result;save();render();flashSuccess('Foto profil diperbarui')};r.readAsDataURL(f);
    }

    // Bottom nav scroll
    document.querySelectorAll('.nav-item').forEach(nav=>{
      nav.onclick=()=>{
        document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
        nav.classList.add('active');
        const target=document.getElementById(nav.dataset.target);
        if(target)target.scrollIntoView({behavior:'smooth'});
      }
    });

    // Loading screen
    window.addEventListener('load',()=>{
      setTimeout(()=>{
        document.getElementById('loadingScreen').classList.add('hide');
      },2000); // 2 detik
    });

    render();
  </script>
</body>
</html>
